<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Case-Example - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="http://localhost:1313/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.css">
  

  

</head>

<body class='page page-default-list'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-ttp üîç">
      <a href="/docs/ttp">
        <span>TTP üîç</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db üè∫">
      <a href="/docs/artefacts">
        <span>Artefacts DB üè∫</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ‚öîÔ∏è">
      <a href="/docs/attacks">
        <span>Attacks DB ‚öîÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tools db üõ†Ô∏è">
      <a href="/docs/tools">
        <span>Tools DB üõ†Ô∏è</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="http://localhost:1313/"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="http://localhost:1313/"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/case-example/index.xml" title="Analyst" />
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home üè°">
      <a href="/">
        <span>Home üè°</span>
      </a>
    </li>
    
    <li class="menu-item-blog ‚úçÔ∏è">
      <a href="/docs/blog">
        <span>Blog ‚úçÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-ttp üîç">
      <a href="/docs/ttp">
        <span>TTP üîç</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db üè∫">
      <a href="/docs/artefacts">
        <span>Artefacts DB üè∫</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db ‚öîÔ∏è">
      <a href="/docs/attacks">
        <span>Attacks DB ‚öîÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-tools db üõ†Ô∏è">
      <a href="/docs/tools">
        <span>Tools DB üõ†Ô∏è</span>
      </a>
    </li>
    
    <li class="menu-item-crypto üóùÔ∏è">
      <a href="/docs/cryptography">
        <span>Crypto üóùÔ∏è</span>
      </a>
    </li>
    
    <li class="menu-item-about me üßùüèΩ‚Äç‚ôÄÔ∏è">
      <a href="/docs/about">
        <span>About me üßùüèΩ‚Äç‚ôÄÔ∏è</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    

    
    



 
 <h1 class="title">Case-Example</h1> 
 

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case1/"> Case 1. Famous Retailer Data Breach</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p><em>The Target Corporation is an American retailing company,  founded in 1902 and  headquartered in Minneapolis, Minnesota. It&rsquo;s the second largest discount retailer in the United States. Target operates 1,916 stores in the United States, and also began operations in Canada in March of 2013. In December 2013, a data breach of Target&rsquo;s systems effected up to 110 million customers. The attackers stole around 110 million customers&rsquo; PII. They had all the IDS/IPS and stuff and were PCI-DSS compliant.</em></p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case2/"> Case 2. Watering Hole Attack</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p><strong>Watering hole</strong> is an attack strategy in which an attacker guesses or observes which websites an organization often uses and infects one or more of them with malware. Eventually, some member of the targeted group will become infected [<a href="https://en.wikipedia.org/wiki/Watering_hole_attack">1</a>].</p>
<p>July, 2012. Several high-profile institutions (financial and tech sectors) were victimized by a watering hole attack.</p>
<h2 id="layout">Layout</h2>
<h3 id="step-1-stake-out-watering-hole">Step 1. Stake out watering hole</h3>
<p>Insert an iframe that redirects users to a 0-day malware download (Trojan Gh0st RAT).</p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case3/"> Case 3. Phishing against Google and Facebook</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p><em>In summary, according to the US attorney&rsquo;s office for the Southern District of New York, scammers stole over $100 million from Facebook and Google in a creative way. Basically, they e-mailed the tech giants and asked for it. The scheme that included setting up a fake business and sending phishing e-mails to employees of Facebook and Google. The scheme ultimately duped those multi-million dollar companies out of more than a hundred million in total between 2013 and 2015.</em></p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case4/"> Case 4. SANS Mock Case</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p><em>Arya Stark gets an email presumably from Direwolf with an attachment. It looks suspicious and she forwards it to the Security.</em></p>
<h2 id="environment">Environment</h2>
<p><strong>Winterfell Server Network</strong> (<code>192.168.10.0/24</code>) consisting of DNS (<code>192.168.10.230</code>) Centos7 with <code>bind</code> <code>ns1.winterfell.local</code> and Mail server (<code>192.168.10.140</code>) <code>mail.winterfell.local</code>, Centos7 with Postfix and Dovecot.</p>
<p><strong>Winterfell Desktop Network</strong> (<code>192.168.11.0/24</code>), having IPs: <code>192.168.11.101</code>, <code>192.168.11.102</code>, <code>192.168.11.103</code>, <code>192.168.11.104</code>, <code>192.168.11.105</code>. <code>192.168.11.105</code> is Security&rsquo;s IP. All desktops have Win7 SP1 with MOffice 2010 installed. For the machine to be vulnerable for the below attack steps, Windows Firewall should be disabled and macro turned on for Office Docs (Trust Center &gt; Trust Center Settings &gt; Macro Settings). Also, PsExec requires the DWORD called LocalAccountTokenFilterPolicy in the registry under</p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case5/"> Case 5. IBM Example</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p><em>Arya Stark gets an email presumably from Direwolf with an attachment. It looks suspicious and she forwards it to the Security.</em></p>
<p>Identify possible threats. Identify attack vectors: Website hosting malicious content waiting for a vulnerable browser. This can be countered with: Qradar, McAfee ePolicy Orchestrator, Next generation firewall.</p>
<p>In Qradar we have several alerts: Malicious URL detected, three possible DDoS and OAS denied access and continued preceded by file infected.</p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case6/"> Case 6. Home Depot PoS Attack</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p><em>This attack started from stealing credentials from a vendor, using them to install malware on around 7500 self-checkout POS terminals and then stealing data. Went unnoticed for 5 months (April - Septemper 2014) and grabbed the data from 56 million credit and debit cards (useful for identity theft) and 53 million emails (useful for phishing). Investigation started on September, 2nd and on 8th indicated that the system was breached. They also offered free credit services to affected customers who use their payment card as early as April of 2014, and apologized for the data breach.</em></p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case7/"> Case 7. Atlanta Ransomware Attack</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<p>22 March, 2018 the City of Atlanta suffered from a ransomware attack. Many devices at City Hall were shutdown. SamSam Ransomware was to blame. Demanded $51000 and the city refused. Shutdown the main devices for 5 days. Many of the operations returned to the traditional handwriting üòä. Atlanta disabled WiFi at the airport up until the 2nd of April.</p>
<h2 id="timeline">Timeline</h2>
<p>22 March, 2018 - ransomware strikes.</p>
<p>May - online water bill payment restored.</p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/ir/case8/"> Case 8. Kaseya Supply Chain Ransomware Attack</a></h2> 
    <p> <h2 id="case-overview">Case Overview</h2>
<h2 id="timeline">Timeline</h2>
<h2 id="lessons-learned">Lessons Learned</h2>
<h2 id="references">References</h2>
<p>[<a href="https://www.zscaler.com/blogs/security-research/kaseya-supply-chain-ransomware-attack-technical-analysis-revil-payload">1</a>] Kaseya Supply Chain Ransomware Attack - Technical Analysis of the REvil Payload</p>
<p>[<a href="https://www.huntress.com/blog/rapid-response-kaseya-vsa-mass-msp-ransomware-incident">2</a>] Case updates and general informaiton.</p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/forensic-cases/case1/"> A Study in Black</a></h2> 
    <p> <p>Someone has violated corporate policy by watching porn using the corp PC.</p>
<p>Do you have the authority?</p>
<p>What are the expected results?</p>
<p><strong>Some prohibited internet traffic</strong>. Check network logs of an application layer firewall üî• or content filter (any gateway between the suspect and the network), filter them out. But the user was smart enough to use VPN. What&rsquo;s then? Application layer firewall only sees application traffic, it is not aware of TCPs, Shudipis and etc. Read <a href="/docs/articles/fundamentals/network/osi/overview">this</a> article about TCP/IP stack to understand better why application layer firewalls won&rsquo;t see anything other than what&rsquo;s on top.</p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/forensic-cases/case2/"> Case 1. IP Theft Linux Investigation</a></h2> 
    <p> <blockquote>
<p>Nearly all IP (intellectual property) are recreated by a competitor. Investigate the development machine</p></blockquote>
<p>Potential data exfiltration.</p>
<ol>
<li><code>netstat -lpeanut</code> shows that there are two dhcp clients running, one using unusual port and user:</li>
</ol>
<p><img src="images/4.png" alt="img"></p>
<ol>
<li><code>ps aux | grep 40500</code> or <code>ps aux | grep dhclient</code> shows the running processes and sometimes commands used to run them. This suspicious client was run from <code>/tmp</code> folder:</li>
</ol>
<p><img src="images/5.png" alt="img5"></p>
<ol>
<li><code>ls -la /tmp/</code> to see the file that was launched. But nothing there. Seems that the file was deleted after being launched:</li>
</ol>
<p><img src="images/6.png" alt="img6"></p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/forensic-cases/case3/"> Case 3. Yet Another Linux Investigation</a></h2> 
    <p> <ol>
<li>Running <code>netstat</code>, see the weird python script with established connection to some remote host:</li>
</ol>
<p><img src="images/10.png" alt="mg10"></p>
<ol start="2">
<li>Grab the executable: <code>lsof -p 2082</code> and <code>ps aux  grep 2082</code>.</li>
</ol>
<p><img src="images/11.png" alt="img11"></p>
<ol start="3">
<li>Let&rsquo;s see the <code>/tmp/</code> folder for <code>backdoor</code> executable</li>
<li>Check <code>/proc/2082</code> and <code>ls</code></li>
</ol>
<p><img src="images/12.png" alt="img12"></p>
<ol start="5">
<li>Since the executable is a legitimate python, need to explore further. In <code>/proc/2082</code> run <code>sudo cat cmdline</code> shows the comand used to launch, <code>cat task/2082/children</code> shows children PID. <code>sudo cat status</code> shows  general information. <code>cat environ</code> shows &hellip; . <code>cat arp</code> shows MAC addresses of the machines connected:</li>
</ol>
<p><img src="todo/cases/forensic-cases/case3/images/1.png" alt="img1"></p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/forensic-cases/case4/"> Case 4. Compromised Apache Server</a></h2> 
    <p> <blockquote>
<p>Compromised Apache Web server with drupal application used for local team. There was some unusual activity noticed between 05/10 and 08/10/19.</p></blockquote>
<p>You need to preserve edidence and some commands override artifacts (like <code>find</code>). Disable access times</p>
<ul>
<li><code>sudo mount -o remount,noatime /dev/...</code> or:</li>
<li><code>mkdir /mnt/extdrv/rootvol</code></li>
<li><code>rootvol=/mnt/extdrv/rootvol</code></li>
<li><code>sudo mount --bind / $rootvol</code></li>
<li><code>sudo mount -o remount,ro $rootvol</code></li>
</ul>
<p>User activity: <code>/etc/passwd</code>. <code>sudo debugfs -R 'stat &lt;1835260&gt;' /dev/...</code>.</p>
<p><img src="todo/cases/forensic-cases/case4/images/2.png" alt="img2"></p>
<p>checking groups. <code>tail -n 4 /etc/group</code>, <code>grep -E 'mail' | php' /etc/group</code></p></p>

    <h2><a href="http://localhost:1313/docs/todo/cases/forensic-cases/case5/"> Case 5. Kali Linux Data Exfiltration</a></h2> 
    <p> <blockquote>
<p>IP theft and Kali Linux is a suspect. Has the user exfiltrated pictures or documents?</p></blockquote>
<p>Can look for info in xdg directories:</p>
<ul>
<li><code>~/.cache</code> ($XDG_CACHE_HOME)</li>
<li><code>~/.local/share</code> ($XDG_DATA_HOME)</li>
<li><code>~/.config</code> ($XDG_CONFIG_HOME)</li>
</ul>
<p>Can look for info in non-xdg dirs:</p>
<ul>
<li><code>~/.&lt;application_name&gt;</code></li>
<li><code>~</code> (user home dir)</li>
</ul>
<p><code>cat .bash_history</code> and defaults in <code>./bashrc</code>. For Kali <code>~/.msf4/history</code> (doesn&rsquo;t log commands for the remote shell), <code>~/.nc_history</code> (created if <code>rlwrap </code> was used to run <code>nc</code>. Also <code>~/.viminfo</code>: cmd history, string search history, input-line history, contents of non-empty regs, marks for several files, file marks pointing to locs in files, last search/sub pattern for &rsquo;n&rsquo; or &lsquo;&amp;&rsquo;, buffer list, global vars. <code>~/.cache/sessions</code> - by xfce-session and only if sessions are saved: list of open progs that were saved from last session (when the user last logged out) for recent Kalis. Xfce-session-[hostname]:0 and <code>.bak</code> - prev version of it. Client - prog or windows that needs to be opened. At the end of the file the amount of progs that are to be run and last time this session was last saved (not opened by user ). XFWM - xfce window manager.</p></p>





    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            <link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/case-example/index.xml" title="Analyst" />
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.js"></script>
  

  


</body>

</html>
