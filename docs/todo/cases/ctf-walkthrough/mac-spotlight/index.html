<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>macOS Spotlight - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="http://localhost:1313/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-ttp ğŸ”">
      <a href="/docs/ttp">
        <span>TTP ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db ğŸº">
      <a href="/docs/artefacts">
        <span>Artefacts DB ğŸº</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db âš”ï¸">
      <a href="/docs/attacks">
        <span>Attacks DB âš”ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tools db ğŸ› ï¸">
      <a href="/docs/tools">
        <span>Tools DB ğŸ› ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="http://localhost:1313/"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="http://localhost:1313/"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-ttp ğŸ”">
      <a href="/docs/ttp">
        <span>TTP ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db ğŸº">
      <a href="/docs/artefacts">
        <span>Artefacts DB ğŸº</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db âš”ï¸">
      <a href="/docs/attacks">
        <span>Attacks DB âš”ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tools db ğŸ› ï¸">
      <a href="/docs/tools">
        <span>Tools DB ğŸ› ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
   <a href="/docs/todo/cases/ctf-walkthrough/"> ğŸ‘ˆğŸ¼ Back to </br> CTFs Walkthroughs </a>
  </p>
  <aside>
   <nav id="TableOfContents">
  <ul>
    <li><a href="#question-1-what-version-of-macos-is-running-on-this-image">Question 1: What version of macOS is running on this image?</a></li>
    <li><a href="#what-competitive-advantage-did-hansel-lie-about-in-the-file-anotherexamplejpg-two-words">What &ldquo;competitive advantage&rdquo; did Hansel lie about in the file AnotherExample.jpg? (two words)</a></li>
    <li><a href="#how-many-bookmarks-are-registered-in-safari">How many bookmarks are registered in safari?</a></li>
    <li><a href="#whats-the-content-of-the-note-titled-passwords">What&rsquo;s the content of the note titled &ldquo;Passwords&rdquo;?</a></li>
    <li><a href="#whats-hanselapricots-password-hint-two-words">What&rsquo;s hansel.apricot&rsquo;s password hint? (two words)</a></li>
    <li><a href="#provide-the-mac-address-of-the-ethernet-adapter-for-this-machine">Provide the MAC address of the ethernet adapter for this machine.</a></li>
    <li><a href="#name-the-data-url-of-the-quarantined-item">Name the data URL of the quarantined item.</a></li>
    <li><a href="#what-app-did-the-user-sneaky-try-to-install-via-a-dmg-file-one-word">What app did the user &ldquo;sneaky&rdquo; try to install via a .dmg file? (one word)</a></li>
    <li><a href="#what-was-the-file-examplestegjpg-renamed-to">What was the file &lsquo;Examplesteg.jpg&rsquo; renamed to?</a></li>
    <li><a href="#how-much-time-was-spent-on-mailzohocom-on-4202020">How much time was spent on mail.zoho.com on 4/20/2020?</a></li>
    <li><a href="#the-main-file-that-stores-hansels-imessages-had-a-few-permissions-changes-how-many-times-did-the-permissions-change">The main file that stores Hansel&rsquo;s iMessages had a few permissions changes. How many times did the permissions change?</a></li>
    <li><a href="#find-the-flag-in-the-goodexamplejpg-image-its-hidden-with-better-tools">Find the flag in the GoodExample.jpg image. It&rsquo;s hidden with better tools.</a></li>
    <li><a href="#whats-the-uid-of-the-user-who-is-responsible-for-connecting-mobile-devices">What&rsquo;s the UID of the user who is responsible for connecting mobile devices?</a></li>
    <li><a href="#what-is-hanselapricots-open-directory-user-uuid">What is hansel.apricot&rsquo;s Open Directory user UUID?</a></li>
    <li><a href="#what-was-exactly-typed-in-the-spotlight-search-bar-on-4202020-020948">What was exactly typed in the Spotlight search bar on 4/20/2020 02:09:48</a></li>
    <li><a href="#lessons-learned">Lessons Learned</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
 </aside>
</div>



          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">macOS Spotlight</h1>
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <div class="meta">
      
      
      <div class="article-category">
          
            
            
            
              <i class="fab fa-apple"></i>
            
            
            
            
          
          
      </div> <br />
      

      
      <div class="article-category">
        <i class="fas fa-tools"></i>
          
          
          <a class="platform-link" href="/tools/grep">grep</a> 
          
           , 
          <a class="platform-link" href="/tools/plutil">plutil</a> 
          
           , 
          <a class="platform-link" href="/tools/mac_apt">mac_apt</a> 
          
           , 
          <a class="platform-link" href="/tools/strings">strings</a> 
          
           , 
          <a class="platform-link" href="/tools/steghide">steghide</a> 
          
      </div> <br />
      
      

      
      <div class="article-tag">
          <i class="fas fa-tag"></i>
          
          
          <a class="tag-link" href="/tags/spoiler" rel="tag">spoiler</a>
          
      </div> 
      
    </div>
    
    <b>Created:</b> 28.07.2022
    <br />

    

  </header>


  <div class="content" itemprop="articleBody">
    <p><em>This writeup is about CyberDefenders macOS Spotlight challenge.</em></p>
<p><a href="https://davidkoepi.wordpress.com/2013/07/06/macforensics4/">https://davidkoepi.wordpress.com/2013/07/06/macforensics4/</a> <a href="https://tmairi.github.io/posts/dissecting-the-ad1-file-format/">https://tmairi.github.io/posts/dissecting-the-ad1-file-format/</a></p>
<h2 id="question-1-what-version-of-macos-is-running-on-this-image">Question 1: What version of macOS is running on this image?</h2>
<p>Using this magical tool <code>grep</code> I was able to find hits for <code>grep -ri macOS .</code>. One of the files, <code>com.apple.touristd</code> contained the information I needed at the bottom.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./Users/sneaky/Library/Application Support/com.apple.touristd/com.apple.touristd.plist
</span></span><span style="display:flex;"><span>./Users/sneaky/Library/Application Support/com.apple.touristd/com.apple.tourist.plist
</span></span></code></pre></div><p>There were also additional hits from logs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/private/var/log/install.log: 061-96008<span style="color:#f92672">(</span>R<span style="color:#f92672">)</span> | macOS Catalina 10.15.4 Update
</span></span><span style="display:flex;"><span>/private/var/log/install.log:2020-03-01 11:05:13-08 stu-62-151-171-184 installd<span style="color:#f92672">[</span>467<span style="color:#f92672">]</span>: PackageKit: Preboot: UpdatePreboot: Commencing operation to update the Preboot Volume <span style="color:#66d9ef">for</span> Target Volume disk1s5 macOS Catalina
</span></span><span style="display:flex;"><span>/private/var/log/install.log:2020-03-01 11:05:13-08 stu-62-151-171-184 installd<span style="color:#f92672">[</span>467<span style="color:#f92672">]</span>: PackageKit: Preboot: UpdatePreboot: Commencing operation to update the Preboot Volume <span style="color:#66d9ef">for</span> Target Volume disk1s5 macOS Catalina
</span></span></code></pre></div><p>TO get the exact and latest versions I&rsquo;ve run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -ri catalina . | grep -v <span style="color:#e6db74">&#34;install.log&#34;</span>
</span></span></code></pre></div><p><code>com.apple.tourist.plist</code> file showed the latest.</p>
<p>ğŸ˜• Other hits were in the following files:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.RecentDocuments.sfl2 matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.FavoriteVolumes.sfl2 matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.FavoriteItems.sfl2 matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Application Support/com.apple.sharedfilelist/com.apple.LSSharedFileList.RecentApplications.sfl2 matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Preferences/com.apple.dock.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Preferences/com.apple.touristd.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Preferences/com.apple.finder.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Users/sneaky/Library/Preferences/com.apple.tourist.plist matches
</span></span></code></pre></div><p>However, not all of these files have cataline keyword. I don&rsquo;t understand why they are showing up.</p>
<h2 id="what-competitive-advantage-did-hansel-lie-about-in-the-file-anotherexamplejpg-two-words">What &ldquo;competitive advantage&rdquo; did Hansel lie about in the file AnotherExample.jpg? (two words)</h2>
<p>I some this <code>zsh_history</code> when I was doing a preliminary research and I remebered that there was something with the <code>AnotherExample.jpg</code> there. I could still do <code>grep -r AnotherExample .</code>. Since the amount of data is very humble, this option works well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -name <span style="color:#e6db74">&#34;*zsh*&#34;</span>  
</span></span><span style="display:flex;"><span>cat <span style="color:#e6db74">&#34;./Volume 0/root/Users/sneaky/zsh_history&#34;</span> Â   
</span></span></code></pre></div><p>This showed me the following commands (irrelevant commands were cut off):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat  
</span></span><span style="display:flex;"><span>cat Example.jpg <span style="color:#e6db74">&#39;!Our newest phone will have helicopter blades and six cameras and &lt;&#34;flip phone&#34;&gt; technology!&#39;</span> &gt; AnotherExample.jpg  
</span></span><span style="display:flex;"><span>cat Example.jpg <span style="color:#f92672">(</span>echo <span style="color:#e6db74">&#39;!Our newest phone will have helicopter blades and six cameras and &lt;&#34;flip phone&#34;&gt; technology!&#39;</span><span style="color:#f92672">)</span> &gt; AnotherExample.jpg  
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;!Our newest phone will have helicopter blades and six cameras and &lt;&#34;flip phone&#34;&gt; technology!&#39;</span> &gt; secret  
</span></span><span style="display:flex;"><span>cat Example.jpg secret &gt; AnotherExample.jpg  
</span></span><span style="display:flex;"><span>cat AnotherExample.jpg
</span></span></code></pre></div><p>There is a hint in the answer, that there are two words. And in the text box for the answer thre first words starts with letter <code>f</code>. So, it&rsquo;s pretty straightworward. ğŸ˜• Not sure, why &ldquo;lied&rdquo;. May be the <code>!</code> at the beginning (meaning NOT in programming)?</p>
<h2 id="how-many-bookmarks-are-registered-in-safari">How many bookmarks are registered in safari?</h2>
<p>The main artefact that shows bookmarks is here: <code>/Users/hansel.apricot/Library/Safari/Bookmarks.plist</code>. Of course, I&rsquo;ve found it either with grep or find (don&rsquo;t remember). Something like <code>find . -name &quot;*bookmark*&quot;</code> or <code>grep -ri bookmark .</code> would do. So, once I identified the most likely candidate, I opened it and looked through. A quick look showed that URLString is the field that stores the bookmark&rsquo;s URL. It&rsquo;s a 1:1 relation, so I did:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>plutil -p <span style="color:#e6db74">&#34;/Users/hansel.apricot/Library/Safari/Bookmarks.plist&#34;</span> | grep URLString | wc -l Â  Â  Â   
</span></span></code></pre></div><h2 id="whats-the-content-of-the-note-titled-passwords">What&rsquo;s the content of the note titled &ldquo;Passwords&rdquo;?</h2>
<p>This was a challenging one indeed. Not because of some encryption, but because it was too simple and I was looking for a complex answer.</p>
<p>Of course, again, I grepped for <code>passwords</code> and got myself a list of candidates. The one that looked the most relevant was <code>./Volume 0/root/Users/hansel.apricot/Library/Group Containers/group.com.apple.notes/NoteStore.sqlite</code>.</p>
<p>A deeper recon:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>strings NoteStore.sqlite | grep Passwords -C5 
</span></span></code></pre></div><p>revealed the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>B6A0F355A-B381-4887-9D9F-6342CB928BAFThat  
</span></span><span style="display:flex;"><span>s a good amount of money they  
</span></span><span style="display:flex;"><span>re offering.555-0123  
</span></span><span style="display:flex;"><span>T~1A  
</span></span><span style="display:flex;"><span>6585435D-75E7-4777-8E99-AE5341D3C72CPasswords  
</span></span><span style="display:flex;"><span>b912D417B-1130-49F9-9EC5-79E41729F082Get 2nd job  
</span></span><span style="display:flex;"><span> no to muchIdeas <span style="color:#66d9ef">for</span> work  
</span></span><span style="display:flex;"><span>LocalAccount3_On My MacOn My Mac  
</span></span><span style="display:flex;"><span>TrashFolder-LocalAccount3_On My MacRecently Deleted  
</span></span><span style="display:flex;"><span>C95EF12E-8CF1-4811-95E0-CE9F9B99FA12New Note
</span></span></code></pre></div><p>So, the note is titled <code>Passwords</code>. I was trying to find this note by id <code>6585435D-75E7-4777-8E99-AE5341D3C72C</code> and there was nothing else. Then I realised that in iOS when you create a note and do not name it explicitly, it&rsquo;s given the same name as the beginnning of its contents.</p>
<p>Besides, in the text box for the answer there was a masked answer starting with the letter <code>P</code>. So, it was much easier than I thought it was.</p>
<h2 id="whats-hanselapricots-password-hint-two-words">What&rsquo;s hansel.apricot&rsquo;s password hint? (two words)</h2>
<p>This is one of the few I knew where to look from the beggining (<a href="https://bakerst221b.com/docs/dfir/investigation/accounts/">here</a>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>plutil -p /var/db/dslocal/nodes/Default/users/hansel.apricot.plist | grep -C2 hint
</span></span></code></pre></div><h2 id="provide-the-mac-address-of-the-ethernet-adapter-for-this-machine">Provide the MAC address of the ethernet adapter for this machine.</h2>
<p>I tried&hellip; wait for it&hellip; <code>grep</code> with regex for this. I really don&rsquo;t remember how I got this one. This one worked for me later: <code>grep -iro '[0-9a-f]\{2\}:[0-9a-f]\{2\}:[0-9a-f]\{2\}:[0-9a-f]\{2\}:[0-9a-f]\{2\}:[0-9a-f]\{2\}' .</code>At last (and I don&rsquo;t think it took long) I found it here: <code>./Volume 0/root/private/var/log/daily.out</code>.</p>
<h2 id="name-the-data-url-of-the-quarantined-item">Name the data URL of the quarantined item.</h2>
<p>Well, grep magic was used here as well. I tried adding a macOS specific MAC <a href="http://www.coffer.com/mac_find/?string=apple">prefix</a> but there were several of them, so, I went on with a different approach.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -ri quarantine . Â   
</span></span><span style="display:flex;"><span>find . -name *quarantine*  
</span></span><span style="display:flex;"><span>cat <span style="color:#e6db74">&#34;./Volume 0/root/Users/sneaky/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2&#34;</span>
</span></span></code></pre></div><h2 id="what-app-did-the-user-sneaky-try-to-install-via-a-dmg-file-one-word">What app did the user &ldquo;sneaky&rdquo; try to install via a .dmg file? (one word)</h2>
<p>No valid result with <code>grep &quot;\.dmg&quot; ./0/root/private/var/log/install.log</code>. However, in <code>./0/root/Users/sneaky/.zsh_history</code> there was the following command: <code>hdiutil mount silenteye-0.4.1b-snowleopard.dmg</code>.</p>
<p><a href="https://futureboy.us/stegano/encode.pl">https://futureboy.us/stegano/encode.pl</a></p>
<p><a href="https://futureboy.us/stegano/encinput.html">https://futureboy.us/stegano/encinput.html</a></p>
<h2 id="what-was-the-file-examplestegjpg-renamed-to">What was the file &lsquo;Examplesteg.jpg&rsquo; renamed to?</h2>
<h2 id="how-much-time-was-spent-on-mailzohocom-on-4202020">How much time was spent on mail.zoho.com on 4/20/2020?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -r <span style="color:#e6db74">&#34;mail.zoho.com&#34;</span> .
</span></span></code></pre></div><p>Found the following results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Binary file ./Volume 0/root/private/var/folders/bf/r04p_gb17xxg37r9ksq855mh0000gn/0/com.apple.ScreenTimeAgent/Store/RMAdminStore-Local.sqlite-wal matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/RecentlyClosedTabs.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/CloudAutoFillCorrections.db matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/History.db matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/Touch Icons Cache/TouchIconCacheSettings.db matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/Bookmarks.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/Template Icons/CacheSettings.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/Favicon Cache/favicons.db matches
</span></span></code></pre></div><p>The file <code>./Volume 0/root/private/var/folders/bf/r04p_gb17xxg37r9ksq855mh0000gn/0/com.apple.ScreenTimeAgent/Store/RMAdminStore-Local.sqlite-wal</code> shows <code>ZUSAGETIMEDITEM</code>, <code>ZTOTALTIMEINSECONDS</code>.</p>
<p>Or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python mac_apt_artifact_only.py SCREENTIME -i <span style="color:#e6db74">&#34;RMAdminStore-Local.sqlite&#34;</span> -o <span style="color:#e6db74">&#34;/Users/username/Documents/&#34;</span>
</span></span></code></pre></div><p>modulus instead of just divide. Maths!</p>
<h2 id="the-main-file-that-stores-hansels-imessages-had-a-few-permissions-changes-how-many-times-did-the-permissions-change">The main file that stores Hansel&rsquo;s iMessages had a few permissions changes. How many times did the permissions change?</h2>
<p>fsevents are very close to USERJRNL and MFT on NTFS and are the first place to look at when you have questions about files created/renamed/modified/deleted etc.</p>
<p>iMessages are stored and <code>chat.db</code> database. In this challenge there was not file with that name (deleted on purpose). However, informaiton about this file will be still kept in <code>fsevents</code> logs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>plutil -p <span style="color:#e6db74">&#34;./Volume 0/root/Users/sneaky/Library/Preferences/com.apple.iChat.plist&#34;</span>
</span></span></code></pre></div><p>resulted in</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span> Â <span style="color:#f92672">&#34;DidCheckForDuplicateChats&#34;</span> <span style="color:#960050;background-color:#1e0010">=&gt;</span> <span style="color:#ae81ff">3</span>  
</span></span><span style="display:flex;"><span> Â <span style="color:#e6db74">&#34;DidMigratePersonCentricIDs&#34;</span> <span style="color:#960050;background-color:#1e0010">=&gt;</span> <span style="color:#ae81ff">1</span>  
</span></span><span style="display:flex;"><span> Â <span style="color:#e6db74">&#34;NotifyAboutMessagesFromUnknownContacts&#34;</span> <span style="color:#960050;background-color:#1e0010">=&gt;</span> <span style="color:#ae81ff">1</span>  
</span></span><span style="display:flex;"><span> Â <span style="color:#e6db74">&#34;PlaySoundsKey&#34;</span> <span style="color:#960050;background-color:#1e0010">=&gt;</span> <span style="color:#ae81ff">1</span>  
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><p>The file looked so juicy and yet there was nothing useful for me there.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -name <span style="color:#e6db74">&#34;*fseve*&#34;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>python mac_apt_artifact_only.py -i samples/FruitBook/fsevents -o . FSEVENTS
</span></span></code></pre></div><h2 id="find-the-flag-in-the-goodexamplejpg-image-its-hidden-with-better-tools">Find the flag in the GoodExample.jpg image. It&rsquo;s hidden with better tools.</h2>
<p>On a Windows VM I used PowerShell and steghide:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>steghide info GoodExample.jpg
</span></span><span style="display:flex;"><span>Enter passphrase<span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#75715e"># no password</span>
</span></span><span style="display:flex;"><span>  embedded file <span style="color:#e6db74">&#34;steganopayload27635.txt&#34;</span><span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>    [...]
</span></span><span style="display:flex;"><span>steghide extract -sf GoodExample.jpg --passphrase <span style="color:#e6db74">&#34;&#34;</span>
</span></span></code></pre></div><h2 id="whats-the-uid-of-the-user-who-is-responsible-for-connecting-mobile-devices">What&rsquo;s the UID of the user who is responsible for connecting mobile devices?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -name <span style="color:#e6db74">&#34;*zsh*&#34;</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â    
</span></span><span style="display:flex;"><span>./Volume 4/root/bin/zsh  
</span></span><span style="display:flex;"><span>./Volume 0/root/Users/sneaky/zsh_history  
</span></span><span style="display:flex;"><span>plutil -p <span style="color:#e6db74">&#34;/Users/sneaky/Library/Preferences/com.apple.finder.plist&#34;</span> &gt; appleplist 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;RecentMoveAndCopyDestinations&#34;</span> <span style="color:#960050;background-color:#1e0010">=&gt;</span> [  
</span></span><span style="display:flex;"><span> Â  Â <span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">=&gt;</span> <span style="color:#e6db74">&#34;file:///Users/Shared/&#34;</span>  ]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>open -t <span style="color:#e6db74">&#34;./macOS Catalina - Data [volume_0]/root/private/var/log/daily.out&#34;</span> Â  Â  Â  Â  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># fsck_hfs.log?</span>
</span></span><span style="display:flex;"><span>grep -ri iphone . <span style="color:#75715e"># Hooray!</span>
</span></span></code></pre></div><p>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <br>
Results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Binary file ./Volume 4/root/System/Library/CoreServices/mapspushd matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 4/root/System/Library/CoreServices/SubmitDiagInfo matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 4/root/System/Library/CoreServices/cloudpaird matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/private/var/db/dslocal/nodes/Default/groups/_usbmuxd.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/private/var/db/dslocal/nodes/Default/users/_usbmuxd.plist matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/private/var/db/dslocal/nodes/Default/sqlindex matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/CloudAutoFillCorrections.db matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/History.db matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/Favicon Cache/favicons.db matches  
</span></span><span style="display:flex;"><span>Binary file ./Volume 0/root/Users/hansel.apricot/Library/Safari/SearchDescriptions.plist matches
</span></span></code></pre></div><h2 id="what-is-hanselapricots-open-directory-user-uuid">What is hansel.apricot&rsquo;s Open Directory user UUID?</h2>
<p>Open Directory is something like Active Directory for Windows. Also uses LDAP.</p>
<p>Found the answer here: <code>./Volume 0/root/private/var/log/install.log</code>.</p>
<p>How? Guess ğŸ¤£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -ri <span style="color:#e6db74">&#34;open directory&#34;</span> .
</span></span></code></pre></div><h2 id="what-was-exactly-typed-in-the-spotlight-search-bar-on-4202020-020948">What was exactly typed in the Spotlight search bar on 4/20/2020 02:09:48</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -name <span style="color:#e6db74">&#34;*spot*&#34;</span> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
</span></span><span style="display:flex;"><span>./plugins/spotlightshortcuts.py  
</span></span><span style="display:flex;"><span>./plugins/spotlight.py  
</span></span><span style="display:flex;"><span>./plugins/__pycache__/spotlightshortcuts.cpython-39.pyc  
</span></span><span style="display:flex;"><span>./plugins/__pycache__/spotlight.cpython-39.pyc  
</span></span><span style="display:flex;"><span>./plugins/helpers/spotlight_filter.py  
</span></span><span style="display:flex;"><span>./plugins/helpers/spotlight_parser.py  
</span></span><span style="display:flex;"><span>./plugins/helpers/__pycache__/spotlight_filter.cpython-39.pyc  
</span></span><span style="display:flex;"><span>./plugins/helpers/__pycache__/spotlight_parser.cpython-39.pyc  
</span></span><span style="display:flex;"><span>./samples/FruitBook/Volume 0/root/private/var/db/dslocal/nodes/Default/groups/_spotlight.plist  
</span></span><span style="display:flex;"><span>./samples/FruitBook/Volume 0/root/private/var/db/dslocal/nodes/Default/users/_spotlight.plist  
</span></span><span style="display:flex;"><span>./samples/FruitBook/Volume 0/root/Users/sneaky/Library/Application Support/com.apple.spotlight  
</span></span><span style="display:flex;"><span>./samples/FruitBook/Volume 0/root/Users/sneaky/Library/Application Support/com.apple.spotlight/com.apple.spotlight.Shortcuts  
</span></span><span style="display:flex;"><span>./samples/FruitBook/Volume 0/root/Users/sneaky/Library/Preferences/com.apple.corespotlightui.plist  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cat ./samples/FruitBook/Volume 0/root/Users/sneakv/Librarv/Application Support/com.apple.spotlight/com.apple.spotlight.Shortcuts
</span></span></code></pre></div><h2 id="lessons-learned">Lessons Learned</h2>
<p>Autopsy is good, but I&rsquo;ve got most of the answers using <code>grep</code>. When you don&rsquo;t know where to look, it&rsquo;s the best option. For loads of data that would not be an option. But for this challenge this worked well and I had a chance to learn where and for what to look for. It&rsquo;s a good way to explore the system you know little about and find out more artefacts.</p>
<h2 id="references">References</h2>
<details>
    <summary>Expand &hellip;</summary>
    Something here
</details>
  </div>
</article>
</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.js"></script>
  

  


</body>

</html>
