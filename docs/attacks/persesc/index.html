<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Persistence and Escalation Mechanisms - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://bakerst221b.com/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.min.0fd8269b84d57bc40ce18bb200a70ca7e1001ccf31f98dc3a8e47fa25f99b326.css">
  

  

</head>

<body class='page page-default-list'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-ttp ğŸ”">
      <a href="/docs/ttp">
        <span>TTP ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db ğŸº">
      <a href="/docs/artefacts">
        <span>Artefacts DB ğŸº</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db âš”ï¸">
      <a href="/docs/attacks">
        <span>Attacks DB âš”ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tools db ğŸ› ï¸">
      <a href="/docs/tools">
        <span>Tools DB ğŸ› ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://bakerst221b.com/"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://bakerst221b.com/"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <link rel="alternate" type="application/rss+xml" href="https://bakerst221b.com/docs/attacks/persesc/index.xml" title="Analyst" />
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-ttp ğŸ”">
      <a href="/docs/ttp">
        <span>TTP ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db ğŸº">
      <a href="/docs/artefacts">
        <span>Artefacts DB ğŸº</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db âš”ï¸">
      <a href="/docs/attacks">
        <span>Attacks DB âš”ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tools db ğŸ› ï¸">
      <a href="/docs/tools">
        <span>Tools DB ğŸ› ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
    <a href="/docs/attacks/"> ğŸ‘ˆğŸ¼ Back to </br> âš”ï¸ Attacks DB </a>
  </p>
</div> 



          </div>
        </div>
        <div class="col-12 col-md-9">
          



 
 <h1 class="title">Persistence and Escalation Mechanisms</h1> 
 

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/collection/"> Collection</a></h2> 
    <p> <p>*There are a lot of techniques to become persistent on a Windows machine. You can refer to the persistence and escalation mechanisms article or look those up on the MITRE website. Although it&rsquo;s important to know the artefacts themselves and the technique, it would be hard to collect them all manually. *</p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/bios/"> BIOS Persistence</a></h2> 
    <p> <p><em>This is about &hellip; .</em></p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/boot/"> Boot Abuse</a></h2> 
    <p> <h2 id="linux">Linux</h2>
<p><code>Init</code> is the process that spawns other processes and usually has pid <code>1</code>. <code>/etc/inittab</code> can be used to set run level for the systems. <code>/etc/rc.d</code> has a collection of files that define what services are running at what level. This information can also be viewed with a <strong>chkconfig</strong> command.</p>
<h3 id="run-levels">Run Levels</h3>
<table>
  <thead>
      <tr>
          <th>Run Level</th>
          <th>Mode</th>
          <th>Action</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>Halt</td>
          <td>Shuts down system</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Single-User Mode â—ï¸</td>
          <td>Does not configure network interfaces, start daemons, or allow non-root logins. Can be used to boot to the super user account and change its password without knowing the old one.</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Multi-User Mode</td>
          <td>Does not configure network interfaces or start daemons.</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Multi-User Mode with Networking â—ï¸</td>
          <td>Starts the system normally. Servers usually run at this level.</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Undefined</td>
          <td>Not used/User-definable</td>
      </tr>
      <tr>
          <td>5</td>
          <td>X11</td>
          <td>As runlevel 3 + display manager(X), main for desktop machines.</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Reboot</td>
          <td>Reboots the system,  shuts down all services when the system is being rebooted</td>
      </tr>
  </tbody>
</table>
<p>[<a href="https://www.liquidweb.com/kb/linux-runlevels-explained/">1</a>]</p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/startup/"> Config Abuse</a></h2> 
    <p> <p><em>Some persistence and escalation techniques don&rsquo;t require an exploit but only a little tweaking of some config.</em></p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/elevation/"> Elevation Control Abuse</a></h2> 
    <p> <h2 id="linux--macos">Linux &amp; macOS</h2>
<h3 id="setuid-and-setgid"><code>setuid</code> and <code>setgid</code></h3>
<p><strong>Platforms</strong>: macOS, Linux
<strong>MITRE</strong>: <a href="https://attack.mitre.org/techniques/T1548/001/">https://attack.mitre.org/techniques/T1548/001/</a></p>
<p><code>setuid</code> or <code>setgid</code> bits set in UNIX. <code>chmod u+s [file]</code> or <code>chmod 4777 [file]</code> to set the bit. To enable the setgid bit,Â <code>chmod 2775</code>Â andÂ <code>chmod g+s</code>Â can be used. Look for the files with the bit set: <code>find / -perm +4000 2&gt;/dev/null</code> and <code>find / -perm +2000 2&gt;/dev/null</code> for the <code>segid</code>.</p>
<p>When a user runs an executable file with the setuid bit set, the real user ID (RUID) of the process is set to the user ID of the user who ran the file, while the effective user ID (EUID) is set to the user ID of the file owner. This means that the process runs with the privileges of the file owner while still retaining the identity of the user who executed the file.</p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/ipc/"> IPC</a></h2> 
    <p> <p><em>This is about &hellip; .</em></p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/kernel/"> Kernel</a></h2> 
    <p> <h2 id="linux">Linux</h2>
<h3 id="lkm">LKM</h3>
<p>LKM for Linux. Drivers are one type of kernel extentions.</p>
<h3 id="xdg">XDG</h3>
<p><a href="https://attack.mitre.org/techniques/T1547/013/">https://attack.mitre.org/techniques/T1547/013/</a></p>
<h2 id="macos">macOS</h2>
<h3 id="kext">kext</h3>
<p><code>kext</code> for macOS. <code>kextload</code> and <code>kextunload</code>. These need to be signed with a cert approved by Apple. Otherwise, to launch the app one needs to disable SIP. That&rsquo;s probably the reason why the RAM cannot be dumped on macOS with SIP enabled. Replaced by System Extentions but still can be used.</p>
<h3 id="reopen">reopen</h3>
<p>Remember the &ldquo;Reopen windows when logging back in&rdquo; prompt on macOS? When selected, all applications currently open are added to a property list file namedÂ <code>com.apple.loginwindow.[UUID].plist</code>Â within theÂ <code>~/Library/Preferences/ByHost</code>Â directory. Applications listed in this file are automatically reopened upon the userâ€™s next logon.</p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/libs/"> Library Abuse</a></h2> 
    <p> <h2 id="windows">Windows</h2>
<h3 id="dll-search-order-hijacking">DLL Search Order Hijacking</h3>
<blockquote>
<p>ğŸ‘‘ - require w permissions for <code>Windows</code> and <code>Windows\System32</code>.</p></blockquote>
<p><strong>Detection</strong>:</p>
<ol>
<li>ğŸ’­ unusual locations for new DLL created or saved during the attack (especially unsigned)</li>
<li>ğŸ’­ see RAM for DLLs loaded from the wrong locations</li>
<li>ğŸ’­ multiple locations for one DLL</li>
<li>ğŸ’­ behavioural analysis (C2C or other)</li>
<li>ğŸ› ï¸ <a href="https://github.com/adamkramer/dll_hijack_detect/releases">https://github.com/adamkramer/dll_hijack_detect/releases</a></li>
<li>IDS/IPS</li>
<li>Integrity controls?</li>
</ol>
<blockquote>
<p><strong>Example</strong>: <code>eplorer.exe</code> loading <code>ntshrui.dll</code>.</p></blockquote>
<p>Following is the search order for modern Windows systems:</p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/services/"> Services</a></h2> 
    <p> <p><em>Services can be abused differently but are often used as escalation and persistence mechanisms.</em></p></p>

    <h2><a href="https://bakerst221b.com/docs/attacks/persesc/tasks/"> Tasks Abuse</a></h2> 
    <p> <h2 id="windows">Windows</h2>
<blockquote>
<p>â—ï¸ Both <code>at</code> and <code>schtasks.exe</code> can create tasks remotely.</p></blockquote>
<p>ğŸº <strong>Artefacts</strong>:</p>
<ol>
<li>ğŸªµ <strong>Event Log</strong>: Task Scheduler Operational.</li>
<li>ğŸ› ï¸ <strong>autoruns</strong></li>
<li>ğŸ“‚ <code>C: \Windows\ Tasks\ \*.job</code></li>
<li>ğŸ“‚ <code>C: \Windows\SchedLgU.txt</code> (Win XP)</li>
<li>ğŸ“‚ <code>C: \Windows\System32\Tasks</code></li>
</ol>
<h3 id="at">at</h3>
<p><code>at.exe</code> (deprecated but can still be used) and <code>schtasks.exe</code>. For <code>at</code> see <code>at*.job</code> and <code>Schdlgu.txt</code></p>
<blockquote>
<p><strong>WinXP</strong>: at jobs run with SYSTEM privileges.</p></blockquote>
<p>Files are created here: <code>\Windows\Tasks</code> and <code>\Windows\System32\Tasks</code> (xml duplicate Win7+). Created with: <code>at.exe 22:22:22 C:\mal.exe</code> or</p></p>





<style>
    body {
    color: #212121;
}

h2 {
    font-weight: bold;
    
}

 
 
 
.pagination {
    display: flex;
    list-style: none;
    border-radius: .25rem;
    margin: 20px 0;
    padding: 0;
    justify-content: center;
}

.page-link {
    position: relative;
    display: block;
    padding: .75rem 1rem;
    margin-left: -1px;
    line-height: 1.25;
    color: #2bbc8a;
    background-color: #fff;
}

.homepage .page-link,
.listing .page-link {
    background-color: #fff;
}

.page-item.disabled .page-link {
    color: #6c757d;
    pointer-events: none;
    cursor: auto;
    background-color: #fff;
    border-color: #dee2e6;
}

.page-item.active .page-link {
    z-index: 1;
    color: #fff;
    background-color: #2bbc8a;;
    border-color:#2bbc8a;
    border-radius: 30px;
}

</style>
<nav aria-label="page navigation">
    <ul class="pagination">
        
        

        

        
             
            <li class="page-item active"><a href="/docs/attacks/persesc/" class="page-link">1</a></li>
            
        
            
             
            <li class="page-item"><a href="/docs/attacks/persesc/page/2/" class="page-link">2</a></li>
            
        

        
        <li class="page-item"><a href="/docs/attacks/persesc/page/2/" rel="next" class="page-link">Next â€º</a></li>
        

        
        
    </ul>
</nav>


        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            <link rel="alternate" type="application/rss+xml" href="https://bakerst221b.com/docs/attacks/persesc/index.xml" title="Analyst" />
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.ec19db7e4836c12e2c5e3697d926bc3e4c22005167d9826aab54feca08f0c093.js"></script>
  

  
  
  
    
  


</body>

</html>
