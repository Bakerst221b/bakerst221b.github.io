<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“š Basics - Analyst</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="http://localhost:1313/favicon.png">
  <link href="/css/style-classic.css"></link>
  
  
  <link rel="stylesheet" href="/css/style.css">
  

  

</head>

<body class='page page-default-list'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-ttp ğŸ”">
      <a href="/docs/ttp">
        <span>TTP ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db ğŸº">
      <a href="/docs/artefacts">
        <span>Artefacts DB ğŸº</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db âš”ï¸">
      <a href="/docs/attacks">
        <span>Attacks DB âš”ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tools db ğŸ› ï¸">
      <a href="/docs/tools">
        <span>Tools DB ğŸ› ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="http://localhost:1313/"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="http://localhost:1313/"><img alt="Logo" src="/images/logo-mobile.svg" /></a>
    </div>
    

    <link rel="alternate" type="application/rss+xml" href="http://localhost:1313/docs/ttp/malware/analyse/basics/index.xml" title="Analyst" />
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home ğŸ¡">
      <a href="/">
        <span>Home ğŸ¡</span>
      </a>
    </li>
    
    <li class="menu-item-blog âœï¸">
      <a href="/docs/blog">
        <span>Blog âœï¸</span>
      </a>
    </li>
    
    <li class="menu-item-ttp ğŸ”">
      <a href="/docs/ttp">
        <span>TTP ğŸ”</span>
      </a>
    </li>
    
    <li class="menu-item-artefacts db ğŸº">
      <a href="/docs/artefacts">
        <span>Artefacts DB ğŸº</span>
      </a>
    </li>
    
    <li class="menu-item-attacks db âš”ï¸">
      <a href="/docs/attacks">
        <span>Attacks DB âš”ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-tools db ğŸ› ï¸">
      <a href="/docs/tools">
        <span>Tools DB ğŸ› ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-crypto ğŸ—ï¸">
      <a href="/docs/cryptography">
        <span>Crypto ğŸ—ï¸</span>
      </a>
    </li>
    
    <li class="menu-item-about me ğŸ§ğŸ½â€â™€ï¸">
      <a href="/docs/about">
        <span>About me ğŸ§ğŸ½â€â™€ï¸</span>
      </a>
    </li>
    
  </ul>
</div>
    
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
    
    <div style="margin-left: 20pt;">
      <a href="/index.xml" type="application/rss+xml">
        <img src="/images/rss.png" alt="RSS Feed">
      </a>
    </div>
    
    <style>
      a[href="/index.xml"] {
        display: inline-block;
        vertical-align: middle;
        margin-right: 10px;
      }
    
      a[href="/index.xml"] img {
        height: 30px;
      }
    </style>
    
  </div>
</div>


    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <p>
    <a href="/docs/ttp/malware/analyse/"> ğŸ‘ˆğŸ¼ Back to </br> ğŸª› Reverse Engineering </a>
  </p>
</div> 



          </div>
        </div>
        <div class="col-12 col-md-9">
          



 
 <h1 class="title">ğŸ“š Basics</h1> 
 

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/cpu/"> ğŸ¤“ About the CPU</a></h2> 
    <p> <p><em>In this article I will dissect what CPU Cache and TLB are. It can help understand how Meltdown and Specter work.</em></p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/memory-addressing/"> Memory Addressing</a></h2> 
    <p> <p><em>I&rsquo;ve had a lot of time to dive into certain pecularities of how programs are outlined both in RAM and on disk when working as a malware analyst. One part of my job was to treat infected files. For that purpose I wrote remedy scripts. For them to work I had to have a solid underatanding where to perform the amputation. Since the topic might be a little confusing, I&rsquo;ve published it here. Originally it was hand-written in my &#x1f48e; notebook &#x1f4d3;.</em></p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/c-prog-memory-layout/"> Proccess Memory Layout</a></h2> 
    <p> <h2 id="intro">Intro</h2>
<p>At the very beginning of my career I found it hard to grasp the notion of memory layout and stack. Even when I read about it several times, it didn&rsquo;t feel solid. That&rsquo;s why I drew drew and drew. Because my mind prefers pictures, analogies, metaphors and examples! So, I&rsquo;ve made that. May be someone finds it useful.</p>
<h2 id="picture">Picture</h2>
<p><img src="images/memoryLayoutC.png" alt="memoryLayoutC"></p>
<h2 id="metaphor-and-analogy">Metaphor and Analogy</h2>
<p>I was thinking about a good metaphor, but that was the extent of my imagination&hellip; Let&rsquo;s say some weirdo (let&rsquo;s call him Gargaralian) is piling up all the boring books he has &#x1f4da; under the table because the appartment is too small and the luxury of having a bookcase is not an option available for him. Besides, the table is a little loose, so that pile of books could be like the fifth leg. Something like that:</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/assebly/"> Assembly ğŸ’¯</a></h2> 
    <p> <p><em>During forensics investigation it&rsquo;s sometimes needed to reverse engineer some suspicious piece of code. This section is a reverse engineering dive-in section.</em></p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/compilation-and-linking/"> Compilation and Linking ğŸ”—</a></h2> 
    <p> <p><em>In this article I am trying to reasearch compilation and linking process.</em></p>
<h2 id="terms">Terms</h2>
<p><code>.cpp</code> - is a human-readable file written in any programming language. In this example it&rsquo;s a file written in C++. An example of this file (meaningless for simplicity sake):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> a, b, c; 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>.obj</code>,  <code>.coff</code> - binary file with its own structure. 1 file of source code (<code>*.cpp</code>) is compiled into 1 <code>.obj</code> or <code>.coff</code> file. Consists of sections, symbol table (name and current location of variable or function that can be referenced by other object files), relocation table (addresses referenced in this file that the linker must adjust when it knows the final memory layout) and debug info. A header that says where in the files the sections below are located ï‚¨ A (concatenated) text segment, which contains all the source code (with some missing addresses) ï‚¨ A (concatenated) data segment (which combines all data and the bss segments)</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/data-types/"> Data Types</a></h2> 
    <p> <h2 id="varint">VarInt</h2>
<p>Is used to safe memory. For example, number 5 only occupies 1 byte, but 1032 will need two bytes to live. They are also little-endian values. But how to tell when the number ends? Easy, the most significant bit of every byte (byte being the smallest space occupied) tells the PC whether there are more bytes to come. So, for example, the following is the number <code>5</code>, just five, no caveats:</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/exceptions/"> Exceptions</a></h2> 
    <p> <p><img src="images/teb-peb-seh.png" alt="teb-peb-seh"></p>
<blockquote>
<p>âš ï¸ Note that x64 does not use this mechanism for exception handling.</p></blockquote>
<p>Consider the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">__try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">TestExceptions</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">__except</span>(EXCEPTION_EXECUTE_HANDLER)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Executing SEH __except block</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>How is that code handled in memory?</p>
<p>This is usually how the SEH is registered (Assembly view):</p>
<pre tabindex="0"><code class="language-assembly" data-lang="assembly">PUSH 0040184B
XOR EAX, EAX
PUSH DWORD PTR FS:[EAX]
MOV DWORD PTR FS:[EAX], ESP
</code></pre><p>NtGlobalFlag FLG_HEAP_ENABLE_TAIL_CHECK (0x10), FLG_HEAP_ENABLE_FREE_CHECK (0x20), and FLG_HEAP_VALIDATE_PARAMETERS (0x40)</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/interrupts/"> Interrupts</a></h2> 
    <p> <h2 id="character-special-files">Character Special Files</h2>
<p>One of the examples of a special files are:</p>
<ul>
<li><code>/dev/stdin</code></li>
<li><code>/dev/stdout</code></li>
<li><code>/dev/random</code> (<a href="https://www.computerhope.com/jargon/p/pseudo-random.htm">PRNG</a> which <strong>may delay returning a value to acquire additional entropy</strong>.) That is why when I <code>cat /dev/random</code> and do nothing else, it just prints the values, but when I start moving the mouse or turning on a movie - it&rsquo;s hanging for a while.</li>
<li><code>/dev/urandom</code> (PRNG which always returns a value immediately, regardless of required entropy.)</li>
</ul>
<p><a href="https://www.computerhope.com/jargon/s/special-file.htm#character-special">https://www.computerhope.com/jargon/s/special-file.htm#character-special</a></p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/unpacking/"> Packers and Unpacking</a></h2> 
    <p> <h2 id="references">References</h2>
<p>[<a href="https://web.archive.org/web/20160420030326/https://exelab.ru/art/?action=cat&amp;id=3">1</a>] Manual unpacking (rus ğŸ‡·ğŸ‡º)</p>
<p>[<a href="https://web.archive.org/web/20160409021823/https://exelab.ru/art/?action=view&amp;id=371">2</a>] Unpacking FSG 2.0 (rus ğŸ‡·ğŸ‡º)</p>
<p>[<a href="https://web.archive.org/web/20160409052443/https://exelab.ru/art/?action=view&amp;id=547">3</a>] Introduction to unpacking (rus ğŸ‡·ğŸ‡º)</p>
<p>[<a href="https://web.archive.org/web/20160408223121/https://exelab.ru/art/?action=view&amp;id=450">4</a>] Unpacking Thunderbolt (rus ğŸ‡·ğŸ‡º)</p>
<p>[<a href="https://web.archive.org/web/20160409053750/https://exelab.ru/art/?action=view&amp;id=402">5</a>] Unpacking Beria (rus ğŸ‡·ğŸ‡º)</p>
<p>[<a href="https://web.archive.org/web/20160409055753/https://exelab.ru/art/?action=view&amp;id=325">6</a>] Unpacking PECompact 2.xx without using ImportRec (rus ğŸ‡·ğŸ‡º)</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/positive-and-negative-numbers/"> Positive and Negative Numbers</a></h2> 
    <p> <h2 id="intro">Intro</h2>
<h2 id="ones-complement">One&rsquo;s complement</h2>
<h2 id="two-complement">Two complement</h2></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/process-thread-mutant/"> Processes, threads and mutants zombie ğŸ§Ÿâ€â™‚ï¸</a></h2> 
    <p> <p><em>In this article I am describing the difference between a process, thread and mutex.</em></p>
<h2 id="process">Process</h2>
<p>When and exe file or other executable file is run, some memory in RAM is allocated and the program&rsquo;s code and data is read from the hard drive and written into RAM. While it&rsquo;s being run, this program exists in two states: in volatile and non-volatile memory. This &ldquo;container&rdquo; is called a process and can be seen using such tools as <a href="/docs/toolkit/general/reverse-toolkit/#process-explorer">Process Explorer</a> or <a href="/docs/toolkit/general/reverse-toolkit/#process-hacker">Process Hacker</a>. Each process manages its resources (handles, memory). If you ran the same program twice, and two processes will be created, the will have different physical addresses but the same virtual addresses (more on that in another article).</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/ios-reversing/"> iOS Reverse Engineering</a></h2> 
    <p> <p><em>During forensic analysis it&rsquo;s not too rare to run into some suspicious application. In this article I&rsquo;m going to learn to reverse engineer iOS applications.</em></p>
<h2 id="analysis-flow">Analysis flow</h2>
<p>First, we need to get IPA file from the device. There are different ways to do so (please, refer to <a href="/docs/toolkit/mobile/ios-btfm-rtfm">BTFM and RTFM</a>). Here I&rsquo;m going to use the easiest one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ipainstaller -i <span style="color:#66d9ef">$(</span>ipainstaller -l | grep -i lassen<span style="color:#66d9ef">)</span> | grep Bundle
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>scp root@<span style="color:#f92672">[</span>device_ip<span style="color:#f92672">]</span>:/path/to/Bundle/ . 
</span></span></code></pre></div><p>Then open the Bundle folder on PC and look for <code>Info.plist</code>. Let&rsquo;s find any strings that start with <code>NS</code> and end with <code>UsageDescription</code>.</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/reference-vs-value/"> Reference vs Value</a></h2> 
    <p> <p>Lorem markdownum aequalis strigis. Saetigeri iubeas, vultu huic alvum nondum
de obside ut laniavit arbor palmis, cum quin. Rupes vetat videndo, armigerae
crimen habet Priamum nec.</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/mutable-vs-immutable/"> Mutable vs Immutable</a></h2> 
    <p> <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> ctypes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> address <span style="color:#f92672">=</span> id(a)
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> address
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4307917216</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> ctypes<span style="color:#f92672">.</span>cast(address, ctypes<span style="color:#f92672">.</span>py_object)<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> ctypes<span style="color:#f92672">.</span>cast(address, ctypes<span style="color:#f92672">.</span>py_object)<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>
</span></span></code></pre></div><p>Similarly, regardless of whether you flag some <code>UITextField</code> as <em>Secure Text Entry</em> or not, it always returns data in the form of a <code>String</code> or <code>NSString</code>.</p>
<p>On the other hand, using the overwritten data outside the compiler&rsquo;s scope (e.g., serializing it in a temp file) guarantees that it will be overwritten but obviously impacts performance and maintenance. You should try to overwrite critical objects with random data or content from non-critical objects. This will make it really difficult to construct scanners that can identify sensitive data on the basis of its management. This can be only done by low-level languages because the compilers and just-in-time virtual machines will ignore those operations for performance reasons if the optimization routines detect that the buffer is no longer used after being overwritten.</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/crackme/"> â› Crackme Algorithm</a></h2> 
    <p> <h2 id="methodology">Methodology</h2>
<ol>
<li>Look at the strings <code>fs strings</code> and <code>f</code> in <code>radare2</code> or <code>rabin -zz</code></li>
<li>Find <code>xrefs</code> for the strings of interest <code>axt @ str.blahblah</code></li>
<li>Determine the input&rsquo;s length</li>
</ol>
<h2 id="crackme-1">Crackme #1</h2>
<p>This one I had to do when applying for a job a while ago. I knew nothing about reverse engineering at that time and little I knew about assembly. And it was the time when I found out about crackme.</p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/crack-me-algo/"> Cracking ğŸ”¨</a></h2> 
    <p> <p><em>Any cracking career is supposed to start with solving simple crackme&rsquo;s. I&rsquo;ve not been doing it all the time, but I&rsquo;ve solved several of them from the simplest to a very hard one which required some math knowledge ğŸ˜¬. This allowed me to craft some sort of algorithm I would like to share.&quot;</em></p></p>

    <h2><a href="http://localhost:1313/docs/ttp/malware/analyse/basics/from-src-to-binary/"> From Src to Binary</a></h2> 
    <p> <p>To read</p>
<p><a href="https://www.airs.com/blog/archives/38">https://www.airs.com/blog/archives/38</a></p></p>





        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
            <link rel="alternate" type="application/rss+xml" href="http://localhost:1313/docs/ttp/malware/analyse/basics/index.xml" title="Analyst" />
            </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.js"></script>
  

  


</body>

</html>
